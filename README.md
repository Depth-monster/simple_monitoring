Написать скрипт на bash для мониторинга процесса test в среде
linux. Скрипт должен отвечать следующим требованиям:
1. Запускаться при запуске системы (предпочтительно написать юнит
systemd в дополнение к скрипту)
2. Отрабатывать каждую минуту
3. Если процесс запущен, то стучаться(по https) на
https://test.com/monitoring/test/api
4. Если процесс был перезапущен, писать в лог /var/log/monitoring.log
(если процесс не запущен, то ничего не делать)
5. Если сервер мониторинга не доступен, так же писать в лог.


Скрипт проверяет, запущен ли процесс с указанным именем, и если он работает, то отправляет запрос по заданному адресу; если сервер недоступен, записывает это в лог, затем сравнивает текущее время запуска процесса с предыдущим, чтобы определить, был ли перезапуск, и если процесс действительно перезапускался, добавляет запись об этом в лог, после чего сохраняет новое время запуска для последующих проверок.


Обратная связь:
/var/log/monitoring.log может быть доступен другим пользователям (не указаны права) — лучше chmod 640. /run/test-monitor наследует права root, что может быть безопасно, но стоит явно задавать права 700 для защиты состояния процесса. Логика отслеживания PID и перезапуска верна.
==============================================================

СТАРАНИЯ ЧАТГПТ:
1. /var/log/monitoring.log без chmod 640

По умолчанию bash создаёт файлы с правами rw-r--r-- (т.е. 644).
Это значит:

Любой пользователь на сервере может:

читать лог, видеть даты перезапуска твоего процесса,

видеть URL мониторинга (https://test.com/monitoring/test/api),

видеть внутренние имена процессов или служебную информацию.

⚠️ Проблема не в том, что кто-то "украдёт" лог, а в том, что информация из него может быть использована для атак или диагностики — например, злоумышленник поймёт, как часто падает твой процесс, и подберёт момент.

chmod 640 делает файл читаемым только для root и группы (например, adm или monitoring), но не для всех.

2. /run/test-monitor без chmod 700

Каталог /run создаётся root-ом, и по умолчанию наследует маску 755.
Если твой скрипт делает mkdir -p /run/test-monitor, без явного chmod, получаешь:

drwxr-xr-x 2 root root 60 Nov  4  /run/test-monitor


Значит:

Любой локальный пользователь может смотреть, что там лежит,
и даже читать файл last.start, если он открыт для чтения.

В худшем случае кто-то сможет подделать state-файл,
и твой скрипт решит, что процесс “не перезапускался”, хотя он падал.

Не критическая уязвимость, но неприятная: фактически ты хранишь состояние, влияющее на логику работы мониторинга, в каталоге с публичным чтением.

chmod 700 /run/test-monitor означает, что только root может туда смотреть или писать — то, что и нужно.
